<template>
  <div class="ai-recommend-page">
    <!-- ËÉåÊôØÂ±ÇÔºöÁ¥´Ëâ≤ÂÖâÊôï -->
    <div class="hero-background">
      <div class="radial-gradient"></div>
      <div class="purple-glow"></div>
    </div>
    
    <div class="main-row">
      <div class="health-col">
        <div class="health-form-container">
          <div class="health-header">
            <h2>üìä {{ t('aiRecommend.healthData') }}</h2>
          </div>
          
          <el-form :model="healthForm" label-position="top" class="health-form">
            <!-- Ë∫´‰ΩìÊï∞ÊçÆ -->
            <h3>üèÉ‚Äç‚ôÇÔ∏è {{ t('aiRecommend.physicalData') }}</h3>
            
            <!-- Á¨¨‰∏ÄË°åÔºöË∫´È´òÂíå‰ΩìÈáç -->
            <el-row :gutter="16">
              <el-col :span="12">
                <el-form-item :label="t('aiRecommend.height')">
                  <el-input-number 
                    v-model="healthForm.height" 
                    :min="100" 
                    :max="220" 
                    :step="1" 
                    style="width: 100%"
                    size="small">
                  </el-input-number>
                  <span class="unit">cm</span>
                </el-form-item>
              </el-col>
              <el-col :span="12">
                <el-form-item :label="t('aiRecommend.weight')">
                  <el-input-number 
                    v-model="healthForm.weight" 
                    :min="30" 
                    :max="200" 
                    :step="1" 
                    style="width: 100%"
                    size="small">
                  </el-input-number>
                  <span class="unit">kg</span>
                </el-form-item>
              </el-col>
            </el-row>
            
            <!-- Á¨¨‰∫åË°åÔºöÂπ¥ÈæÑÂíåÊÄßÂà´ -->
            <el-row :gutter="16">
              <el-col :span="12">
                <el-form-item :label="t('aiRecommend.age')">
                  <el-input-number 
                    v-model="healthForm.age" 
                    :min="1" 
                    :max="120" 
                    :step="1" 
                    style="width: 100%"
                    size="small">
                  </el-input-number>
                </el-form-item>
              </el-col>
              <el-col :span="12">
                <el-form-item :label="t('aiRecommend.gender')">
                  <el-radio-group v-model="healthForm.gender" size="small">
                    <el-radio value="male">{{ t('aiRecommend.male') }}</el-radio>
                    <el-radio value="female">{{ t('aiRecommend.female') }}</el-radio>
                  </el-radio-group>
                </el-form-item>
              </el-col>
            </el-row>
            
            <!-- Ê¥ªÂä®Ê∞¥Âπ≥ -->
            <el-form-item :label="t('aiRecommend.activityLevel')">
              <el-select v-model="healthForm.activityLevel" style="width: 100%;" size="small" popper-class="ai-recommend-select-popper">
                <el-option :label="t('aiRecommend.activityLevels.sedentary')" value="sedentary"></el-option>
                <el-option :label="t('aiRecommend.activityLevels.lightlyActive')" value="lightly_active"></el-option>
                <el-option :label="t('aiRecommend.activityLevels.moderatelyActive')" value="moderately_active"></el-option>
                <el-option :label="t('aiRecommend.activityLevels.veryActive')" value="very_active"></el-option>
                <el-option :label="t('aiRecommend.activityLevels.extraActive')" value="extra_active"></el-option>
              </el-select>
            </el-form-item>
            
            <!-- ÂÅ•Â∫∑ÊëòË¶Å -->
            <div class="health-summary" v-if="bmi > 0">
              <h3>üìà {{ t('aiRecommend.healthSummary.title') }}</h3>
              <div class="summary-item">
                <span>{{ t('aiRecommend.healthSummary.bmi') }}: </span>
                <strong>{{ bmi.toFixed(1) }}</strong>
                <el-tag :type="bmiStatusTagType(bmiStatus)" effect="light" size="small" class="bmi-status">
                  {{ t(`aiRecommend.healthSummary.status.${bmiStatus}`) }}
                </el-tag>
              </div>
              <div class="summary-item">
                <span>{{ t('aiRecommend.healthSummary.dailyCalories') }}: </span>
                <strong>{{ dailyCalories.toFixed(0) }} {{ t('aiRecommend.healthSummary.calorieUnit') }}</strong>
              </div>
              <div class="advice-box">
                <p class="advice-text">{{ t(dietaryAdvice) }}</p>
              </div>
            </div>
            
            <!-- È•ÆÈ£üÂÅèÂ•Ω -->
            <h3>üçΩÔ∏è {{ t('aiRecommend.dietaryPreferences') }}</h3>
            
            <!-- ÂÅèÂ•ΩÂíåÈÅøÂÖçÁöÑÈ£üÊùêÂπ∂ÊéíÊòæÁ§∫ -->
            <el-row :gutter="16">
              <el-col :span="12">
                <el-form-item :label="t('aiRecommend.preferredIngredients')">
                  <el-select 
                    v-model="preferencesForm.favoriteIngredients" 
                    multiple 
                    filterable
                    allow-create
                    default-first-option
                    :placeholder="t('aiRecommend.selectIngredients')"
                    style="width: 100%;"
                    size="small"
                    popper-class="ai-recommend-select-popper">
                    <el-option 
                      v-for="ingredient in allIngredients" 
                      :key="ingredient.id" 
                      :label="$i18n.locale === 'en' ? ingredient.name_en : ingredient.name" 
                      :value="ingredient.id">
                    </el-option>
                  </el-select>
                </el-form-item>
              </el-col>
              <el-col :span="12">
                <el-form-item :label="t('aiRecommend.avoidedIngredients')">
                  <el-select 
                    v-model="preferencesForm.avoidedIngredients" 
                    multiple 
                    filterable
                    allow-create
                    default-first-option
                    :placeholder="t('aiRecommend.selectIngredients')"
                    style="width: 100%;"
                    size="small"
                    popper-class="ai-recommend-select-popper">
                    <el-option 
                      v-for="ingredient in allIngredients" 
                      :key="ingredient.id" 
                      :label="$i18n.locale === 'en' ? ingredient.name_en : ingredient.name" 
                      :value="ingredient.id">
                    </el-option>
                  </el-select>
                </el-form-item>
              </el-col>
            </el-row>
            
            <!-- È•ÆÈ£üÈôêÂà∂ -->
            <el-form-item :label="t('aiRecommend.dietaryRestrictions')">
              <el-checkbox-group v-model="preferencesForm.restrictions" class="dietary-restrictions">
                <el-checkbox value="vegetarian" size="small">{{ t('aiRecommend.restrictions.vegetarian') }}</el-checkbox>
                <el-checkbox value="vegan" size="small">{{ t('aiRecommend.restrictions.vegan') }}</el-checkbox>
                <el-checkbox value="low_sugar" size="small">{{ t('aiRecommend.restrictions.lowCarb') }}</el-checkbox>
              </el-checkbox-group>
            </el-form-item>
            
            <el-button type="primary" @click="generateRecommendation" :loading="loading" style="width: 100%;" size="default">
              {{ t('aiRecommend.generateRecommendations') }}
            </el-button>
          </el-form>
        </div>
      </div>
      
      <div class="recommend-col">
        <div class="recommendation-container">
          <div class="recommend-header">
            <h2 class="section-title">{{ t('aiRecommend.recommendedForYou') }}</h2>
          </div>
          <div class="recommend-content">
          
          <el-skeleton v-if="loading" :rows="5" animated />
          
          <template v-else-if="recommendedRecipes.length > 0">
            <p class="recommendation-intro">
              {{ t('aiRecommend.recommendationBasis', { bmiValue: bmi.toFixed(1), bmiStatus: t(`aiRecommend.bmiStatus.${bmiStatus}`), calories: dailyCalories.toFixed(0) }) }}
              <span v-if="bmiStatus === 'underweight'">{{ t('aiRecommend.underweightAdvice') }}</span>
              <span v-else-if="bmiStatus === 'normal'">{{ t('aiRecommend.normalWeightAdvice') }}</span>
              <span v-else>{{ t('aiRecommend.overweightAdvice') }}</span>
            </p>
            
            <el-row :gutter="16">
              <el-col v-for="recipe in recommendedRecipes" 
                     :key="recipe.id" 
                     :xs="24" 
                     :sm="12" 
                     :md="12" 
                     :lg="8" 
                     :xl="6"
                     class="recipe-col">
                <recipe-card 
                  :recipe="recipe" 
                  @click="viewRecipeDetail(recipe.id)"
                  @favorite-change="onFavoriteChange"
                />
              </el-col>
            </el-row>
          </template>
          
          <el-empty v-else-if="hasGenerated" :description="t('aiRecommend.noRecommendationsFound')">
            <el-button @click="generateRecommendation">{{ t('aiRecommend.tryAgain') }}</el-button>
          </el-empty>
          
          <div v-else class="recommendation-placeholder">
            <el-empty :description="t('aiRecommend.enterDataForRecommendations')">
              <span class="placeholder-icon">üìä</span>
            </el-empty>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted, watch } from 'vue';
import { useRouter } from 'vue-router';
import { useI18n } from 'vue-i18n';
import { ElMessage } from 'element-plus';

import RecipeCard from '../components/RecipeCard.vue';
import { calculateBMI, getBMIStatus, calculateDailyCalories } from '../utils/helpers';
// Ê≥®ÊÑèÔºö‰∏çÂÜç‰ΩøÁî®ÂêéÁ´ØAPIÔºå‰ΩøÁî®Á∫ØÂâçÁ´ØÊô∫ËÉΩÊé®ËçêÁÆóÊ≥ï
import { getUserHealthData, saveUserHealthData, getUserPreferences, saveUserPreferences } from '../api/userService';
import { getAllIngredients, getAllRecipes } from '../api/recipeService';

const router = useRouter();
const { t } = useI18n();
const loading = ref(false);
const hasGenerated = ref(false);
const allIngredients = ref([]);

const healthForm = ref({
  height: 170,
  weight: 65,
  age: 30,
  gender: 'male',
  activityLevel: 'moderately_active'
});

const preferencesForm = ref({
  cuisines: [],
  favoriteIngredients: [],
  avoidedIngredients: [],
  restrictions: []
});

const recommendedRecipes = ref([]);

const bmi = computed(() => {
  return calculateBMI(healthForm.value.weight, healthForm.value.height);
});

const bmiStatus = computed(() => {
  return getBMIStatus(bmi.value);
});

const dailyCalories = computed(() => {
  const { weight, height, age, gender, activityLevel } = healthForm.value;
  return calculateDailyCalories(weight, height, age, gender, activityLevel);
});

// FIXED: Helper function is now defined inside the component
const getDietaryAdviceByBMI = (status) => {
  switch(status) {
    case 'underweight': return 'aiRecommend.dietaryAdvice.underweight';
    case 'normal': return 'aiRecommend.dietaryAdvice.normal';
    case 'overweight': return 'aiRecommend.dietaryAdvice.overweight';
    case 'obese': return 'aiRecommend.dietaryAdvice.obese';
    default: return 'aiRecommend.dietaryAdvice.default';
  }
};

const dietaryAdvice = computed(() => {
  return getDietaryAdviceByBMI(bmiStatus.value);
});

const bmiStatusTagType = (status) => {
  switch (status) {
    case 'underweight': return 'info';
    case 'normal': return 'success';
    case 'overweight': return 'warning';
    case 'obese': return 'danger';
    default: return 'info';
  }
};



// Êô∫ËÉΩÊé®ËçêÂáΩÊï∞ - ÊîπËøõÁöÑÊé®ËçêÁÆóÊ≥ï
const getFallbackRecommendations = async (preferences) => {
  try {
    console.log('ÂºÄÂßãËé∑ÂèñÊô∫ËÉΩÊé®ËçêÔºåÂÅèÂ•ΩËÆæÁΩÆ:', preferences);
    
    // Ëé∑ÂèñÊâÄÊúâËèúË∞±Êï∞ÊçÆ
    const allRecipes = await getAllRecipes();
    console.log('Ëé∑ÂèñÂà∞ËèúË∞±Êï∞ÊçÆ:', allRecipes?.length || 0, 'Êù°');
    
    if (!allRecipes || allRecipes.length === 0) {
      console.warn('Ê≤°ÊúâËèúË∞±Êï∞ÊçÆ');
      return [];
    }

    let filteredRecipes = [...allRecipes];
    console.log('ÂàùÂßãËèúË∞±Êï∞Èáè:', filteredRecipes.length);

    // Ê†áÂáÜÂåñÈ£üÊùêÊï∞ÊçÆ - Â§ÑÁêÜ‰∏çÂêåÁöÑÊï∞ÊçÆÊ†ºÂºè
    const normalizeIngredients = (stuff) => {
      if (!stuff) return [];
      if (Array.isArray(stuff)) {
        return stuff.flatMap(item => 
          typeof item === 'string' ? item.split(/[„ÄÅÔºå,]/) : [item]
        ).map(item => item.trim()).filter(Boolean);
      }
      if (typeof stuff === 'string') {
        return stuff.split(/[„ÄÅÔºå,]/).map(item => item.trim()).filter(Boolean);
      }
      return [];
    };

    // Âü∫‰∫éÂÅèÂ•ΩÈ£üÊùêËøõË°åËøáÊª§ÔºàÂ¶ÇÊûúÊúâÂÅèÂ•ΩÈ£üÊùêÔºå‰ºòÂÖàÊé®ËçêÂåÖÂê´Ëøô‰∫õÈ£üÊùêÁöÑËèúË∞±Ôºâ
    if (preferences.favoriteIngredients && preferences.favoriteIngredients.length > 0) {
      console.log('Â∫îÁî®ÂÅèÂ•ΩÈ£üÊùêËøáÊª§:', preferences.favoriteIngredients);
      const favoriteSet = new Set(preferences.favoriteIngredients.map(ing => ing.toLowerCase()));
      
      const matchedRecipes = filteredRecipes.filter(recipe => {
        const ingredients = normalizeIngredients(recipe.stuff);
        return ingredients.some(ingredient => 
          favoriteSet.has(ingredient.toLowerCase()) || 
          Array.from(favoriteSet).some(fav => ingredient.toLowerCase().includes(fav))
        );
      });
      
      if (matchedRecipes.length > 0) {
        filteredRecipes = matchedRecipes;
        console.log('ÂÅèÂ•ΩÈ£üÊùêËøáÊª§ÂêéËèúË∞±Êï∞Èáè:', filteredRecipes.length);
      }
    }

    // ÊéíÈô§ÈÅøÂÖçÁöÑÈ£üÊùê
    if (preferences.avoidedIngredients && preferences.avoidedIngredients.length > 0) {
      console.log('ÊéíÈô§ÈÅøÂÖçÁöÑÈ£üÊùê:', preferences.avoidedIngredients);
      const avoidedSet = new Set(preferences.avoidedIngredients.map(ing => ing.toLowerCase()));
      
      const beforeCount = filteredRecipes.length;
      filteredRecipes = filteredRecipes.filter(recipe => {
        const ingredients = normalizeIngredients(recipe.stuff);
        return !ingredients.some(ingredient => 
          avoidedSet.has(ingredient.toLowerCase()) || 
          Array.from(avoidedSet).some(avoid => ingredient.toLowerCase().includes(avoid))
        );
      });
      console.log(`ÊéíÈô§ÈÅøÂÖçÈ£üÊùêÂêéËèúË∞±Êï∞Èáè: ${beforeCount} -> ${filteredRecipes.length}`);
    }

    // Â∫îÁî®È•ÆÈ£üÈôêÂà∂ - ÊîπËøõÁöÑËØÜÂà´ÈÄªËæë
    if (preferences.restrictions && preferences.restrictions.length > 0) {
      console.log('Â∫îÁî®È•ÆÈ£üÈôêÂà∂:', preferences.restrictions);
      
      if (preferences.restrictions.includes('vegetarian')) {
        // Á¥†È£ü‰∏ª‰πâ - ÊéíÈô§ÊâÄÊúâËÇâÁ±ªÂíåÊµ∑È≤ú
        const meatKeywords = [
          // Â∏∏ËßÅËÇâÁ±ª
          'ËÇâ', 'ÁâõËÇâ', 'Áå™ËÇâ', 'È∏°ËÇâ', 'ÁæäËÇâ', 'È∏≠ËÇâ', 'ÈπÖËÇâ',
          // ËÇâÂà∂ÂìÅ
          'ËÖäËÇ†', 'È¶ôËÇ†', 'ÂüπÊ†π', 'ÁÅ´ËÖø', 'ËÇâÊùæ', 'ËÇâ‰∏∏', 'ËÇâÈ•º',
          // Êµ∑È≤úÁ±ª
          'È±º', 'Ëôæ', 'Ëüπ', 'Ë¥ù', 'Ëõ§', 'Ëöå', 'È±øÈ±º', 'Á´†È±º', 'Êµ∑ÂèÇ',
          // Âä®Áâ©ÂÜÖËÑè
          'ËÇù', 'ËÇæ', 'ÂøÉ', 'ËÇ∫', 'ËÇö', 'ËÇ†', 'Ë°Ä',
          // ÂÖ∂‰ªñÂä®Áâ©‰∫ßÂìÅ
          'È∏°ÁøÖ', 'È∏°ËÖø', 'ÊéíÈ™®', 'ÁâõËÖ©', 'Áå™ËπÑ'
        ];
        
        const beforeCount = filteredRecipes.length;
        filteredRecipes = filteredRecipes.filter(recipe => {
          const ingredients = normalizeIngredients(recipe.stuff);
          const recipeName = recipe.name || '';
          
          // Ê£ÄÊü•È£üÊùêÂíåËèúÂêç
          const hasMeat = ingredients.some(ingredient => 
            meatKeywords.some(meat => ingredient.includes(meat))
          ) || meatKeywords.some(meat => recipeName.includes(meat));
          
          return !hasMeat;
        });
        console.log(`Á¥†È£üËøáÊª§ÂêéËèúË∞±Êï∞Èáè: ${beforeCount} -> ${filteredRecipes.length}`);
      }
      
      if (preferences.restrictions.includes('vegan')) {
        // Á∫ØÁ¥†È£ü - ÊéíÈô§ÊâÄÊúâÂä®Áâ©‰∫ßÂìÅ
        const animalProducts = [
          // ËÇâÁ±ªÔºàÂ∑≤Âú®Á¥†È£ü‰∏≠ÊéíÈô§Ôºâ
          'ËÇâ', 'Áâõ', 'Áå™', 'È∏°', 'Áæä', 'È∏≠', 'ÈπÖ', 'È±º', 'Ëôæ', 'Ëüπ',
          // ËõãÁ±ª
          'Ëõã', 'È∏°Ëõã', 'È∏≠Ëõã', 'ÈπåÈπëËõã',
          // Â•∂Âà∂ÂìÅ
          'Â•∂', 'ÁâõÂ•∂', 'ÈÖ∏Â•∂', 'Â•∂ÈÖ™', 'ËäùÂ£´', 'ÈªÑÊ≤π', 'Â•∂Ê≤π', '‰π≥',
          // ËúÇËúú
          'Ëúú', 'ËúÇËúú',
          // ÂÖ∂‰ªñÂä®Áâ©‰∫ßÂìÅ
          'ÊòéËÉ∂', 'È±ºËÉ∂', 'ÁáïÁ™ù'
        ];
        
        const beforeCount = filteredRecipes.length;
        filteredRecipes = filteredRecipes.filter(recipe => {
          const ingredients = normalizeIngredients(recipe.stuff);
          const recipeName = recipe.name || '';
          
          const hasAnimalProducts = ingredients.some(ingredient => 
            animalProducts.some(animal => ingredient.includes(animal))
          ) || animalProducts.some(animal => recipeName.includes(animal));
          
          return !hasAnimalProducts;
        });
        console.log(`Á∫ØÁ¥†È£üËøáÊª§ÂêéËèúË∞±Êï∞Èáè: ${beforeCount} -> ${filteredRecipes.length}`);
      }
      
                   
      if (preferences.restrictions.includes('low_sugar')) {
        // ‰ΩéÁ≥ñ/‰ΩéÁ¢≥Ê∞¥ - ÊéíÈô§È´òÁ≥ñÈ´òÁ¢≥Ê∞¥È£üÊùê
        const highCarbIngredients = [
          'Á≥ñ', 'ËúÇËúú', 'Á∫¢Á≥ñ', 'ÁôΩÁ≥ñ', 'ÂÜ∞Á≥ñ',
          'Á±≥È•≠', 'Èù¢Êù°', 'Èù¢ÂåÖ', 'ÂúüË±Ü', 'Á∫¢ËñØ',
          'ËõãÁ≥ï', 'ÁîúÂìÅ', 'Á≥ñÊûú'
        ];
        
        filteredRecipes = filteredRecipes.filter(recipe => {
          const ingredients = normalizeIngredients(recipe.stuff);
          const recipeName = recipe.name || '';
          
          const hasHighCarb = ingredients.some(ingredient => 
            highCarbIngredients.some(carb => ingredient.includes(carb))
          ) || highCarbIngredients.some(carb => recipeName.includes(carb));
          
          return !hasHighCarb;
        });
      }
    }

    // Â¶ÇÊûúËøáÊª§ÂêéËèúË∞±Â§™Â∞ëÔºåÊîæÂÆΩÈôêÂà∂
    if (filteredRecipes.length < 3) {
      console.log('ËøáÊª§ÂêéËèúË∞±Â§™Â∞ëÔºå‰ΩøÁî®ÈªòËÆ§Êé®Ëçê');
      // ËøîÂõû‰∏Ä‰∫õÂÅ•Â∫∑ÁöÑÁÉ≠Èó®ËèúË∞±
      filteredRecipes = allRecipes.filter(recipe => {
        const recipeName = recipe.name || '';
        return recipeName.includes('Ëî¨Ëèú') || recipeName.includes('Ê±§') || 
               recipeName.includes('Ê≤ôÊãâ') || recipeName.includes('Ê∏ÖËí∏');
      }).slice(0, 12);
      
      if (filteredRecipes.length === 0) {
        filteredRecipes = allRecipes.slice(0, 12);
      }
    }

    // ÈöèÊú∫ÈÄâÊã©Âπ∂ÈôêÂà∂Êï∞Èáè
    const shuffled = filteredRecipes.sort(() => 0.5 - Math.random());
    const result = shuffled.slice(0, 12);
    
    console.log('ÊúÄÁªàÊé®ËçêËèúË∞±Êï∞Èáè:', result.length);
    return result;

  } catch (error) {
    console.error('Ëé∑ÂèñÊô∫ËÉΩÊé®ËçêÂ§±Ë¥•:', error);
    return [];
  }
};

const loadUserData = async () => {
  try {
    const savedHealthData = await getUserHealthData();
    if (savedHealthData) {
      healthForm.value = { ...healthForm.value, ...savedHealthData };
    }
    const savedPreferences = await getUserPreferences();
    if (savedPreferences) {
      preferencesForm.value = { ...preferencesForm.value, ...savedPreferences };
    }
    const ingredients = await getAllIngredients();
    console.log('Âä†ËΩΩÁöÑÈ£üÊùêÊï∞ÊçÆ:', ingredients);
    allIngredients.value = ingredients;
  } catch (error) {
    console.error('Âä†ËΩΩÁî®Êà∑Êï∞ÊçÆÂ§±Ë¥•:', error);
    // Â¶ÇÊûúÈ£üÊùêÂä†ËΩΩÂ§±Ë¥•ÔºåËÆæÁΩÆ‰∏Ä‰∏™Á©∫Êï∞ÁªÑÁ°Æ‰øùÁªÑ‰ª∂‰∏ç‰ºöÂ¥©Ê∫É
    allIngredients.value = [];
  }
};

const saveUserData = async () => {
  try {
    await saveUserHealthData({
      ...healthForm.value,
      bmi: bmi.value,
      bmiStatus: bmiStatus.value,
      dailyCalories: dailyCalories.value
    });
    await saveUserPreferences(preferencesForm.value);
  } catch (error) {
    console.error('‰øùÂ≠òÁî®Êà∑Êï∞ÊçÆÂ§±Ë¥•:', error);
  }
};

// Enhanced recommendation function with fallback logic
const generateRecommendation = async () => {
  loading.value = true;
  try {
    await saveUserData();
    
    // --- PREPARE PAYLOAD ---
    // Convert ingredient IDs to names before sending to the backend
    const processedPreferences = JSON.parse(JSON.stringify(preferencesForm.value));
    
    const idToNameMap = new Map(allIngredients.value.map(item => [item.id, item.name]));

    if (processedPreferences.avoidedIngredients) {
      processedPreferences.avoidedIngredients = processedPreferences.avoidedIngredients.map(
        idOrName => idToNameMap.get(idOrName) || idOrName
      );
    }
    if (processedPreferences.favoriteIngredients) {
      processedPreferences.favoriteIngredients = processedPreferences.favoriteIngredients.map(
        idOrName => idToNameMap.get(idOrName) || idOrName
      );
    }
    // --- END PREPARE PAYLOAD ---

    // ‰ΩøÁî®ÊîπËøõÁöÑÊô∫ËÉΩÊé®ËçêÁÆóÊ≥ï
    console.log('ÂºÄÂßãÁîüÊàêÊé®ËçêÔºåÂÅ•Â∫∑Êï∞ÊçÆ:', {
      bmi: bmi.value,
      bmiStatus: bmiStatus.value,
      dailyCalories: dailyCalories.value
    });
    
    const smartRecipes = await getFallbackRecommendations(processedPreferences);
    recommendedRecipes.value = smartRecipes;
    hasGenerated.value = true;
    
    if (smartRecipes.length > 0) {
      ElMessage.success(`‰∏∫ÊÇ®Êô∫ËÉΩÊé®Ëçê‰∫Ü ${smartRecipes.length} ÈÅìËèúË∞±`);
    } else {
      ElMessage.warning('ÊöÇÊó∂Êó†Ê≥ïÁîüÊàêÊé®ËçêÔºåËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÂÅèÂ•ΩËÆæÁΩÆÊàñÁ®çÂêéÈáçËØï');
    }
  } catch (error) {
    console.error('ÁîüÊàêÊé®ËçêÂ§±Ë¥•:', error);
    ElMessage.error('ÁîüÊàêÊé®ËçêÊó∂ÂèëÁîüÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï');
    recommendedRecipes.value = [];
    hasGenerated.value = true;
  } finally {
    loading.value = false;
  }
};

const viewRecipeDetail = (recipeId) => {
  router.push(`/recipe/${recipeId}`);
};

const onFavoriteChange = ({ recipe, isFavorite }) => {
  const actionText = isFavorite ? t('common.addedTo') : t('common.removedFrom');
  ElMessage.success(`${t('common.successfully')} ${actionText} ${t('common.favorites')}: "${recipe.name}"`);
};

onMounted(async () => {
  await loadUserData();
});

watch([() => healthForm.value.height, () => healthForm.value.weight, () => healthForm.value.age], () => {
  if (hasGenerated.value) {
    recommendedRecipes.value = [];
    hasGenerated.value = false;
  }
});
</script>

<style scoped>
.ai-recommend-page {
  padding: 20px !important; /* Ê∑ªÂä†ÂÜÖËæπË∑ù */
  margin: 0 auto !important;
  width: 100% !important;
  max-width: 1440px !important; /* ÈôêÂà∂ÊúÄÂ§ßÂÆΩÂ∫¶ */
  height: calc(100vh - 70px) !important; /* ÂáèÂéªÂØºËà™Ê†èÈ´òÂ∫¶ */
  overflow: visible !important;
  display: flex !important;
  justify-content: center !important;
  box-sizing: border-box !important;
}

.main-row {
  height: 100% !important;
  width: 100% !important;
  max-width: 1200px !important; /* Ëøõ‰∏ÄÊ≠•ÈôêÂà∂ÂÜÖÂÆπÂÆΩÂ∫¶ */
  margin: 0 auto !important;
  padding: 0 !important;
  display: flex !important;
  flex: 1 !important;
  box-sizing: border-box !important;
  border-radius: 16px !important; /* Ê∑ªÂä†ÂúÜËßí */
  overflow: visible !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important; /* Ê∑ªÂä†Èò¥ÂΩ± */
}

/* ‰∏§ÂàóÂ∏ÉÂ±Ä */
.health-col, .recommend-col {
  height: 100% !important;
  padding: 0 !important;
  margin: 0 !important;
  border-right: 1px solid var(--el-border-color);
  display: flex !important;
  flex-direction: column !important;
  box-sizing: border-box !important;
  overflow: hidden;
}

.health-col {
  flex: 1.5 !important; /* 1.5‰ªΩÂÆΩÂ∫¶ */
  min-width: 0;
}

.recommend-col {
  flex: 2.5 !important; /* 2.5‰ªΩÂÆΩÂ∫¶ */
  border-right: none;
  min-width: 0;
}

/* ÂÅ•Â∫∑Êï∞ÊçÆÂÆπÂô® - ‰ΩøÁî®ÁæéÈ£üÂ±ïÂéÖÁöÑÁ¥´Ëâ≤ÈÄèÊòéÊ°ÜÊû∂Ê†∑Âºè */
.health-form-container {
  height: 100%;
  overflow-y: auto;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  box-shadow: 
    0 20px 40px rgba(0, 0, 0, 0.1),
    0 8px 16px rgba(0, 0, 0, 0.06),
    inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
  border-radius: 24px !important;
  backdrop-filter: blur(10px) !important;
  position: relative !important;
  overflow: visible !important;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
  display: flex;
  flex-direction: column;
}

.health-form-container:hover {
  transform: translateY(-4px);
  box-shadow: 
    0 25px 50px rgba(0, 0, 0, 0.15),
    0 12px 24px rgba(0, 0, 0, 0.08),
    inset 0 1px 0 rgba(255, 255, 255, 0.4);
}

.health-form-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
}

.health-form-container .health-form {
  flex: 1;
  overflow-y: auto;
}

.health-header {
  padding: 20px 20px 0 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.3);
  background: rgba(255, 255, 255, 0.5) !important; /* ÈÄèÊòéÂåñÂ§¥ÈÉ®ËÉåÊôØ */
  backdrop-filter: blur(8px) !important;
}

.health-header h2 {
  margin: 0 0 20px 0;
  font-size: 1.5rem;
  color: var(--el-text-color-primary);
  font-weight: 600;
}

.health-form {
  padding: 20px;
}

/* ‰ºòÂåñË°®ÂçïÂ∏ÉÂ±Ä */
.health-form .el-form-item {
  margin-bottom: 16px;
}

.health-form .el-form-item__label {
  font-size: 14px;
  font-weight: 500;
  padding-bottom: 4px;
}

/* Âçï‰ΩçÊ†∑Âºè‰ºòÂåñ */
.unit {
  margin-left: 8px;
  color: var(--el-text-color-secondary);
  font-size: 13px;
  font-weight: 500;
}

/* ÊÄßÂà´ÈÄâÊã©ÂçïÈÄâÊåâÈíÆÊØõÁéªÁíÉÊ†∑Âºè */
.health-form :deep(.el-radio-group .el-radio) {
  margin-right: 16px !important;
}

.health-form :deep(.el-radio-group .el-radio__input .el-radio__inner) {
  background: rgba(102, 126, 234, 0.1) !important;
  backdrop-filter: blur(8px) !important;
  border: 2px solid rgba(255, 255, 255, 0.2) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
  width: 18px !important;
  height: 18px !important;
}

.health-form :deep(.el-radio-group .el-radio__input:hover .el-radio__inner) {
  background: rgba(102, 126, 234, 0.2) !important;
  transform: scale(1.1) !important;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3) !important;
}

.health-form :deep(.el-radio-group .el-radio__input.is-checked .el-radio__inner) {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)) !important;
  border-color: rgba(102, 126, 234, 0.8) !important;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
}

.health-form :deep(.el-radio-group .el-radio__input.is-checked .el-radio__inner::after) {
  background: white !important;
  width: 8px !important;
  height: 8px !important;
}

.health-form :deep(.el-radio-group .el-radio__label) {
  color: var(--el-text-color-primary) !important;
  font-weight: 500 !important;
  font-size: 14px !important;
  padding-left: 8px !important;
}

/* È•ÆÈ£üÈôêÂà∂Â§çÈÄâÊ°ÜÊ®™ÂêëÂ∏ÉÂ±Ä */
.dietary-restrictions {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.dietary-restrictions .el-checkbox {
  margin-right: 0;
}

/* Â§çÈÄâÊ°ÜÊØõÁéªÁíÉÊ†∑Âºè */
.dietary-restrictions :deep(.el-checkbox__input .el-checkbox__inner) {
  background: rgba(102, 126, 234, 0.1) !important;
  backdrop-filter: blur(8px) !important;
  border: 2px solid rgba(255, 255, 255, 0.2) !important;
  border-radius: 4px !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.dietary-restrictions :deep(.el-checkbox__input:hover .el-checkbox__inner) {
  background: rgba(102, 126, 234, 0.2) !important;
  transform: scale(1.1) !important;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3) !important;
}

.dietary-restrictions :deep(.el-checkbox__input.is-checked .el-checkbox__inner) {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)) !important;
  border-color: rgba(102, 126, 234, 0.8) !important;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
}

.dietary-restrictions :deep(.el-checkbox__label) {
  color: var(--el-text-color-primary) !important;
  font-weight: 500 !important;
  font-size: 14px !important;
}

/* Â∞èÂ∞∫ÂØ∏ÁªÑ‰ª∂‰ºòÂåñ - ÊØõÁéªÁíÉÈ£éÊ†º */
.health-form .el-input-number {
  width: 100%;
}

.health-form :deep(.el-input-number .el-input__inner) {
  padding-left: 8px;
  padding-right: 8px;
  background: rgba(255, 255, 255, 0.1) !important;
  backdrop-filter: blur(8px) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  border-radius: 8px !important;
}

/* Êï∞Â≠óËæìÂÖ•Ê°ÜÂä†ÂáèÊåâÈíÆÊØõÁéªÁíÉÊ†∑Âºè */
.health-form :deep(.el-input-number .el-input-number__increase),
.health-form :deep(.el-input-number .el-input-number__decrease) {
  background: rgba(102, 126, 234, 0.1) !important;
  backdrop-filter: blur(8px) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  border-radius: 6px !important;
  color: var(--el-text-color-primary) !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
}

.health-form :deep(.el-input-number .el-input-number__increase:hover),
.health-form :deep(.el-input-number .el-input-number__decrease:hover) {
  background: rgba(102, 126, 234, 0.2) !important;
  transform: translateY(-1px) !important;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3) !important;
}

.health-form :deep(.el-input-number .el-input-number__increase:active),
.health-form :deep(.el-input-number .el-input-number__decrease:active) {
  transform: translateY(0) scale(0.95) !important;
}

/* ‰∏ãÊãâÈÄâÊã©Ê°ÜÊØõÁéªÁíÉÊ†∑Âºè */
.health-form :deep(.el-select .el-select__wrapper) {
  background: rgba(255, 255, 255, 0.1) !important;
  backdrop-filter: blur(8px) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  border-radius: 8px !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.health-form :deep(.el-select .el-select__wrapper:hover) {
  background: rgba(255, 255, 255, 0.15) !important;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2) !important;
  transform: translateY(-1px) !important;
}

.health-form :deep(.el-select .el-select__wrapper.is-focused) {
  background: rgba(255, 255, 255, 0.2) !important;
  border-color: rgba(102, 126, 234, 0.6) !important;
  box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2) !important;
}

.health-form :deep(.el-select .el-select__selected-item) {
  color: var(--el-text-color-primary) !important;
}

.health-form :deep(.el-select .el-select__caret) {
  color: var(--el-text-color-regular) !important;
}

/* Â§öÈÄâ‰∏ãÊãâÊ°ÜÊ†∑Âºè */
.health-form :deep(.el-select .el-select__wrapper .el-select__input) {
  color: var(--el-text-color-primary) !important;
}

.health-form :deep(.el-select .el-select__wrapper .el-select__placeholder) {
  color: var(--el-text-color-placeholder) !important;
}

/* Â§öÈÄâÊ†áÁ≠æÊ†∑Âºè */
.health-form :deep(.el-select .el-select__wrapper .el-select__tags .el-tag) {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)) !important;
  backdrop-filter: blur(8px) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  border-radius: 12px !important;
  color: var(--el-text-color-primary) !important;
  font-weight: 500 !important;
  padding: 4px 10px !important;
  margin: 2px !important;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15) !important;
}

.health-form :deep(.el-select .el-select__wrapper .el-select__tags .el-tag .el-tag__close) {
  color: var(--el-text-color-regular) !important;
  border-radius: 50% !important;
  transition: all 0.2s !important;
}

.health-form :deep(.el-select .el-select__wrapper .el-select__tags .el-tag .el-tag__close:hover) {
  background: rgba(255, 255, 255, 0.2) !important;
  color: var(--el-text-color-primary) !important;
}

/* ‰∏ãÊãâËèúÂçïÂºπÂá∫Â±ÇÊØõÁéªÁíÉÊ†∑Âºè - ‰ΩøÁî® popper-class */
:global(.ai-recommend-select-popper.el-select-dropdown) {
  background: rgba(40, 35, 60, 0.75) !important;
  backdrop-filter: blur(20px) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  border-radius: 16px !important;
  box-shadow: 
    0 20px 40px rgba(0, 0, 0, 0.2),
    0 8px 16px rgba(0, 0, 0, 0.1) !important;
  padding: 8px !important;
}

:global(.ai-recommend-select-popper.el-select-dropdown .el-select-dropdown__item) {
  background: transparent !important;
  color: var(--el-text-color-primary) !important;
  border-radius: 10px !important;
  margin: 2px 0 !important;
  padding: 10px 14px !important;
  font-weight: 500 !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

:global(.ai-recommend-select-popper.el-select-dropdown .el-select-dropdown__item:hover) {
  background: rgba(102, 126, 234, 0.2) !important;
  transform: translateX(4px) !important;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2) !important;
}

:global(.ai-recommend-select-popper.el-select-dropdown .el-select-dropdown__item.is-selected) {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.4), rgba(118, 75, 162, 0.4)) !important;
  color: white !important;
  font-weight: 700 !important;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4) !important;
}

:global(.ai-recommend-select-popper.el-popper[data-popper-placement^="bottom"] .el-popper__arrow::before) {
  background: rgba(40, 35, 60, 0.75) !important;
  border-color: transparent !important;
}

/* ‰∫ÆËâ≤Ê®°Âºè‰∏ãÁöÑ‰∏ãÊãâËèúÂçï */
:global(html:not(.dark) .ai-recommend-select-popper.el-select-dropdown) {
  background: rgba(255, 255, 255, 0.9) !important;
  border: 1px solid rgba(0, 0, 0, 0.1) !important;
  box-shadow: 
    0 20px 40px rgba(0, 0, 0, 0.1),
    0 8px 16px rgba(0, 0, 0, 0.05) !important;
}

:global(html:not(.dark) .ai-recommend-select-popper.el-select-dropdown .el-select-dropdown__item) {
  color: rgba(30, 41, 59, 0.9) !important;
}

:global(html:not(.dark) .ai-recommend-select-popper.el-select-dropdown .el-select-dropdown__item:hover) {
  background: rgba(102, 126, 234, 0.1) !important;
  color: rgba(30, 41, 59, 1) !important;
}

:global(html:not(.dark) .ai-recommend-select-popper.el-select-dropdown .el-select-dropdown__item.is-selected) {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)) !important;
  color: rgba(30, 41, 59, 1) !important;
  font-weight: 700 !important;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2) !important;
}

:global(html:not(.dark) .ai-recommend-select-popper.el-popper[data-popper-placement^="bottom"] .el-popper__arrow::before) {
  background: rgba(255, 255, 255, 0.9) !important;
  border-color: transparent !important;
}

/* Ê∑±Ëâ≤Ê®°Âºè‰∏ãÁöÑ‰∏ãÊãâËèúÂçï */
:global(.dark .ai-recommend-select-popper.el-select-dropdown) {
  background: rgba(20, 15, 40, 0.8) !important;
}

:global(.dark .ai-recommend-select-popper.el-select-dropdown .el-select-dropdown__item.is-selected) {
  color: white !important;
}

:global(.dark .ai-recommend-select-popper.el-popper[data-popper-placement^="bottom"] .el-popper__arrow::before) {
  background: rgba(20, 15, 40, 0.8) !important;
}

/* ÁîüÊàêÊé®ËçêÊåâÈíÆÊ†∑Âºè - ÊØõÁéªÁíÉÈ£éÊ†º */
.health-form .el-button {
  font-size: 15px;
  font-weight: 600;
  padding: 12px 20px;
  border-radius: 12px !important;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)) !important;
  backdrop-filter: blur(10px) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  color: white !important;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3) !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.health-form .el-button:hover {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9)) !important;
  transform: translateY(-2px) !important;
  box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4) !important;
}

.health-form .el-button:active {
  transform: translateY(0) scale(0.98) !important;
}



/* Êé®ËçêÁªìÊûúÂÆπÂô® - ‰ΩøÁî®ÁæéÈ£üÂ±ïÂéÖÁöÑÁ¥´Ëâ≤ÈÄèÊòéÊ°ÜÊû∂Ê†∑Âºè */
.recommendation-container {
  height: 100%;
  overflow-y: auto;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  box-shadow: 
    0 20px 40px rgba(0, 0, 0, 0.1),
    0 8px 16px rgba(0, 0, 0, 0.06),
    inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
  border-radius: 24px !important;
  backdrop-filter: blur(10px) !important;
  position: relative !important;
  overflow: visible !important;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
  display: flex;
  flex-direction: column;
}

.recommendation-container:hover {
  transform: translateY(-4px);
  box-shadow: 
    0 25px 50px rgba(0, 0, 0, 0.15),
    0 12px 24px rgba(0, 0, 0, 0.08),
    inset 0 1px 0 rgba(255, 255, 255, 0.4);
}

.recommendation-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
}

.recommend-header {
  padding: 20px 20px 0 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.3);
  background: rgba(255, 255, 255, 0.5) !important; /* ÈÄèÊòéÂåñÂ§¥ÈÉ®ËÉåÊôØ */
  backdrop-filter: blur(8px) !important;
}

.recommend-header .section-title {
  margin: 0 0 20px 0;
  font-size: 1.3rem;
  color: var(--el-text-color-primary);
}

.recommend-content {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}

/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 768px) {
  .health-col, .recommend-col {
    border-right: none;
    border-bottom: 1px solid var(--el-border-color);
    flex: none;
    width: 100%;
  }
  
  .main-row {
    flex-direction: column;
  }
  
  .ai-recommend-page {
    height: auto;
    min-height: calc(100vh - 70px);
  }
}



.health-form h3 {
  margin-top: 16px;
  margin-bottom: 12px;
  font-size: 1.2rem;
  color: var(--el-text-color-primary);
  font-weight: 600;
}

.health-form h3:first-of-type {
  margin-top: 0;
}



.health-summary {
  margin-top: 18px;
  margin-bottom: 18px;
  padding: 18px;
  background: linear-gradient(135deg, var(--el-color-info-light-9) 0%, var(--el-color-primary-light-9) 100%);
  border-radius: 10px;
  border: 1px solid var(--el-color-info-light-6);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.health-summary h3 {
  margin-top: 0;
  margin-bottom: 14px;
  font-size: 1.3rem;
  color: var(--el-text-color-primary);
  font-weight: 700;
}

.summary-item {
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  flex-wrap: nowrap;
  white-space: normal;
  font-size: 16px;
  line-height: 1.6;
}

.summary-item span:first-child {
  color: var(--el-text-color-regular);
  font-weight: 500;
}

.summary-item strong {
  margin: 0 6px;
  color: var(--el-color-primary);
  flex-shrink: 0;
  font-size: 17px;
  font-weight: 700;
}

.bmi-status {
  margin-left: 8px;
  flex-shrink: 0; /* Èò≤Ê≠¢ tag Ë¢´ÂéãÁº© */
}

.advice-box {
  margin-top: 16px;
  padding: 14px;
  background: linear-gradient(135deg, var(--el-fill-color-lighter) 0%, var(--el-color-info-light-9) 100%);
  border-radius: 8px;
  border-left: 4px solid var(--el-color-primary);
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
}

.advice-text {
  font-family: 'KaiTi', 'Ê•∑‰Ωì', 'ÂçéÊñáÊ•∑‰Ωì', 'STKaiti', serif;
  font-size: 15px;
  color: var(--el-text-color-primary);
  line-height: 1.7;
  margin: 0;
  font-weight: 500;
  letter-spacing: 0.5px;
}



.recommendation-intro {
  margin-bottom: 20px;
  color: var(--el-text-color-secondary);
}

.recipe-col {
  margin-bottom: 20px;
}

.recommendation-placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 400px;
  background: transparent !important;
  border-radius: 8px;
  color: var(--el-text-color-secondary);
}

.placeholder-icon {
  font-size: 4rem;
  margin-bottom: 20px;
  color: var(--el-text-color-placeholder);
}

/* ËÉåÊôØÂ±ÇÊ†∑Âºè - ‰∏éHomeÈ°µÈù¢‰∏ÄËá¥ */
.hero-background {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: -1;
}

/* ÂæÑÂêëÊ∏êÂèòËÉåÊôØ */
.radial-gradient {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(
      ellipse 20% 80% at 50% -20%,
      rgba(75, 85, 150, 0.4),
      transparent
    ),
    linear-gradient(
      135deg,
      rgba(88, 28, 135, 0.15) 0%,
      rgba(139, 69, 19, 0.1) 50%,
      rgba(30, 58, 138, 0.15) 100%
    );
  transition: background 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Ê∑±Ëâ≤Ê®°Âºè‰∏ãÁöÑÁ¥´Ëâ≤ÈÄèÊòéÊ°ÜÊû∂ */
.dark .health-form-container,
.dark .recommendation-container {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  box-shadow: 
    0 20px 40px rgba(0, 0, 0, 0.3),
    0 8px 16px rgba(0, 0, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
}

/* Ê∑±Ëâ≤Ê®°Âºè‰∏ãÁöÑÊØõÁéªÁíÉÁªÑ‰ª∂Ê†∑Âºè */
.dark .health-form :deep(.el-input-number .el-input__inner) {
  background: rgba(31, 41, 55, 0.3) !important;
  border-color: rgba(255, 255, 255, 0.1) !important;
  color: var(--el-text-color-primary) !important;
}

.dark .health-form :deep(.el-input-number .el-input-number__increase),
.dark .health-form :deep(.el-input-number .el-input-number__decrease) {
  background: rgba(102, 126, 234, 0.15) !important;
  border-color: rgba(255, 255, 255, 0.1) !important;
}

.dark .health-form :deep(.el-radio-group .el-radio__input .el-radio__inner) {
  background: rgba(31, 41, 55, 0.3) !important;
  border-color: rgba(255, 255, 255, 0.15) !important;
}

.dark .dietary-restrictions :deep(.el-checkbox__input .el-checkbox__inner) {
  background: rgba(31, 41, 55, 0.3) !important;
  border-color: rgba(255, 255, 255, 0.15) !important;
}

.dark .health-form :deep(.el-select .el-select__wrapper) {
  background: rgba(31, 41, 55, 0.3) !important;
  border-color: rgba(255, 255, 255, 0.1) !important;
}

.dark .health-form :deep(.el-select .el-select__wrapper:hover) {
  background: rgba(31, 41, 55, 0.4) !important;
}

.dark .health-header,
.dark .recommend-header {
  background: rgba(31, 41, 55, 0.5) !important; /* Ê∑±Ëâ≤Ê®°Âºè‰∏ãÁöÑÈÄèÊòéÂ§¥ÈÉ® */
  border-bottom: 1px solid rgba(75, 85, 99, 0.3);
}

/* ‰∫ÆËâ≤Ê®°ÂºèÁöÑÂæÑÂêëÊ∏êÂèò */
:root:not(.dark) .ai-recommend-page {
  background: transparent !important;
}

:root:not(.dark) .radial-gradient {
  background: 
    radial-gradient(
      ellipse 20% 80% at 50% -20%,
      rgba(120, 119, 198, 0.15),
      transparent
    ),
    linear-gradient(
      135deg,
      rgba(168, 85, 247, 0.05) 0%,
      rgba(236, 72, 153, 0.05) 50%,
      rgba(59, 130, 246, 0.05) 100%
    );
}

/* Á¥´Ëâ≤ÂÖâÊôïÂ±Ç */
.purple-glow {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(
      ellipse 40% 60% at 30% 20%, 
      rgba(88, 28, 135, 0.2), 
      transparent 50%
    ),
    radial-gradient(
      ellipse 50% 80% at 70% 80%, 
      rgba(67, 56, 202, 0.15), 
      transparent 50%
    ),
    radial-gradient(
      ellipse 60% 40% at 50% 50%, 
      rgba(139, 69, 19, 0.1), 
      transparent 50%
    );
  filter: blur(3px);
  opacity: 0.9;
  transition: background 0.8s cubic-bezier(0.4, 0, 0.2, 1), 
             opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ‰∫ÆËâ≤Ê®°ÂºèÁöÑÁ¥´Ëâ≤ÂÖâÊôï */
:root:not(.dark) .purple-glow {
  background: 
    radial-gradient(
      ellipse 40% 60% at 30% 20%, 
      rgba(168, 85, 247, 0.08), 
      transparent 50%
    ),
    radial-gradient(
      ellipse 50% 80% at 70% 80%, 
      rgba(59, 130, 246, 0.06), 
      transparent 50%
    ),
    radial-gradient(
      ellipse 60% 40% at 50% 50%, 
      rgba(236, 72, 153, 0.05), 
      transparent 50%
    );
  opacity: 0.7;
}
</style> 